---
title: Занятие 35
description: «REST, RPC и работа с внешними API»
---

# OTUS

## Javascript Basic

<!-- v -->

## REST, RPC и работа с внешними API

<!-- v -->

### План вебинара:

- Request–Response APIs
- fetch vs XHR
- правила REST
- сторонние апи
<!-- s -->

### Request–Response APIs

<!-- v -->

#### Основные свойства Request–Response API

- API предоставляется посредством HTTP веб сервера
- API предоставляет набор эндпоинтов
- клиент делает http запрос **request** на нужные эндпоинты и получает ответ **response**
- response обычно в формате JSON или XML
<!-- v -->

#### Самые распространенные request-response API

- REST
- RPC
- GraphQL
<!-- s -->

### REST

<!-- v -->

_Representational State Transfer (REST)_ - самый популярный подход для разработки API в наше время

Применяется такими компаниями, как Google, Stripe, Twitter, Github и т.д.

<!-- v -->

REST - это про resources и методы работы с этими ресурсами

**Resource** - это объект, который может быть идентифицирован, назван, адресован или обработан в сети.

<!-- v -->

REST представляет данные в виде ресурсов и использует стандартные методы HTTP для представления операций над этими ресурсами

<!-- v -->

#### Примеры ресурсов

Stripe API представляет пользователей (customers), расходы (charges), платежный баланс (balance), возмещение денежных средств (refunds), события (events), файлы (files) и выплаты (payouts) как ресурсы.

<!-- v -->

#### Некоторые общие правила, которым следуют REST API:

<!-- v -->

Ресурсы являются частью URL-адресов, например **/users**

<!-- v -->

Для каждого ресурса обычно реализуются два URL-адреса: один для коллекции, например **/users**, и один для определенного элемента, например **/users/U123**

<!-- v -->

Существительные вместо глаголов. Например, вместо **/getUserInfo/U123** используется **/users/U123**

<!-- v -->

- **C**reate - используйте POST для создания новых ресурсов
- **R**ead - используйте GET для чтения ресурсов. Запросы GET никогда не изменяют состояние ресурса. У них нет побочных эффектов; метод GET имеет семантику только для чтения. GET идемпотентен. Следовательно, вы можете кэшировать вызовы.
- **U**pdate - используйте PUT для замены ресурса и PATCH для частичного обновления существующих ресурсов.
- **D**elete - используйте DELETE для удаления существующих ресурсов.
  <!-- v -->
  Стандартные коды состояния ответа HTTP возвращаются сервером, указывая на успех или неудачу.
- **2XX** успех
- **3XX** перемещение ресурса
- **4XX** ошибки на стороне клиента (например, отсутствие обязательного параметра или слишком много запросов)
- **5XX** ошибки на стороне сервера
  <!-- v -->
  CRUD операции, HTTP глаголы и REST соглашения
  ![CRUD операции, HTTP глаголы, and REST соглашения](/images/REST_CRUD_operations.png)
  <!-- v -->
  HTTP-запрос для получение платежа через Stripe API

```
GET /v1/charges/ch_CWyutlXs9pZyfD
HOST api.stripe.com
Authorization: Bearer YNoJ1Yq64iCBhzfL9HNO00fzVrsEjtVl
```

HTTP-запрос для создание списания средств через Stripe API

```
POST /v1/charges
HOST api.stripe.com
Authorization: Bearer YNoJ1Yq64iCBhzfL9HNO00fzVrsEjtVl
```

<!-- v -->

Ресурс, который может существовать только в другом ресурсе, должен быть представлен как сабресурс, а не как ресурс верхнего уровня в URL-адресе.

<!-- v -->

Например, GitHub API использует сабресурсы для представления отношений в различных API:

<div style="text-align: left"> Создать issue</div>

```
POST /repos/:owner/:repo/issues
```

<div style="text-align: left"> Получить определенный issue</div>

```
GET /repos/:owner/:repo/issues/:number
```

<div style="text-align: left"> Получить все issue</div>

```
GET /repos/:owner/:repo/issues
```

<div style="text-align: left"> Изменить issue</div>

```
PATCH /repos/:owner/:repo/issues/:number
```

<!-- v -->

А что если нужно больше 4 видов операций? Например, архивировать репозиторий
![Архивировать репозиторий](/images/Archive_repo.png)

<!-- v -->

Помимо типичных операций CRUD, которые мы только что рассмотрели, API REST иногда может потребовать представления операций, не относящихся к CRUD. В этом случае обычно используются следующие подходы:

<!-- v -->

#### Действие как часть поля ресурса

API GitHub использует флаг **archive** в качестве входного параметра для API редактирования репозитория, чтобы представить действие архивирования репозитория

```console
PATCH /repos/vvscode/otus--javascript-basic
HOST api.github.com
Content-Type: application/json
Authorization: token OAUTH-TOKEN
{
  "archived": true
}
```

<!-- v -->

#### Действию как саб - ресурс

API GitHub использует этот шаблон для блокировки и разблокировки проблемы.

```console
PUT /repos/:owner/:repo/issues/:number/lock
```

<!-- v -->

Некоторые операции, такие как поиск, еще сложнее вписать в парадигму REST. Типичная практика в этом случае - использовать только команду действия в URL-адресе API.

```console
GET /search/code?q=:query:
```

Пример поиска файлов в GitHub, соответствующих заданному запросу.

<!-- s -->

### Remote Procedure Call

<!-- v -->

**Удаленный вызов процедур (RPC)** - это одна из простейших парадигм API, в которой клиент выполняет блок кода на другом сервере.

<!-- v -->

В то время как **REST** рассматривает ресурсы, RPC касается действий. Клиенты обычно передают имя метода и аргументы серверу и получают обратно JSON или XML.

<!-- v -->

API RPC обычно следуют двум простым правилам:

- endpoint-ы содержат имя выполняемой операции
- вызовы API выполняются с помощью наиболее подходящего HTTP-глагола: GET для запросов чтения и POST для других
  <!-- v -->
  Стиль RPC отлично подходит для API, которые предоставляют различные действия, которые могут иметь больше нюансов и сложностей, чем может быть инкапсулировано с помощью CRUD
  <!-- v -->
  Пример HTTP запроса к Slack API

```console
POST /api/conversations.archive
HOST slack.com
Content-Type: application/x-www-form-urlencoded
Authorization: Bearer xoxp-1650112-jgc2asDae
```

API позволяет выполнять несколько действий, таких как архивирование, присоединение, удаление, выход и переименование. Хотя в этом случае есть явный «ресурс», не все эти действия хорошо вписываются в шаблон REST.

<!-- v -->

![Slack conversation API](/images/slack_conversation_API.png)

<!-- s -->
